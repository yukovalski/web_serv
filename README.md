# web_server

It was a huge group project and we made it as a team: ctragula
We had to build a non blocking HTTP 1.1 server, written in C++ 98 and conditionally compliant with the HTTP RFC 7230 to 7235.

- Вы можете использовать любой макрос и определять, например, FD_SET, FD_CLR, FD_ISSET, FD_ZERO (понимание того, что они делают и как они это делают, очень полезно.)
- Вы должны написать HTTP-сервер на C ++ 98.
- Если вам нужно больше функций C, вы можете их использовать, но всегда предпочитайте C ++.
- Стандарт C ++ должен быть C ++ 98. Ваш проект должен компилироваться с ним.
- Нет внешней библиотеки, нет Boost и т. Д.
- Старайтесь всегда использовать как можно больше кода "C ++" (например, используйте <cstring> вместо <string.h>).
- Ваш сервер должен быть совместим с выбранным вами веб-браузером.
- Мы будем считать, что Nginx совместим с HTTP 1.1 и может использоваться для сравнения заголовков и поведения ответов.
- В теме и шкале мы будем упоминать опрос, но вы можете использовать его эквиваленты, такие как select, kqueue, epoll.
- Он должен быть неблокирующим и использовать только 1 опрос (или эквивалент) для всех операций ввода-вывода между клиентом и сервером (включая прослушивание).
- poll (или эквивалент) должен проверять чтение и запись одновременно.
- Ваш сервер ни в коем случае не должен блокироваться, и при необходимости клиент должен правильно отказываться.
- Вы никогда не должны выполнять операцию чтения или записи, не пройдя опрос (или эквивалент).
- Строго запрещено проверять значение errno после операции чтения или записи.
- Запрос к вашему серверу никогда не должен зависать вечно.
- На вашем сервере должны быть страницы ошибок по умолчанию, если они не указаны.
- Ваша программа не должна протекать и никогда не должна падать (даже при нехватке памяти, если вся инициализация выполнена)
- Вы не можете использовать fork для чего-то другого, кроме CGI (например, php, python и т. Д.)
- Вы не можете запустить другой веб-сервер ...
- Ваша программа должна иметь в качестве аргумента файл конфигурации или использовать путь по умолчанию.
- Вам не нужно использовать опрос (или эквивалент) перед чтением файла конфигурации.
- Вы должны иметь возможность обслуживать полностью статический веб-сайт.
- Клиент должен иметь возможность загружать файлы.
- Коды состояния ответа HTTP должны быть точными.
- Вам нужны как минимум методы GET, POST и DELETE.
- Стресс-тесты вашего сервера: он должен оставаться доступным любой ценой.
- Ваш сервер может прослушивать несколько портов (см. Файл конфигурации).

  Мы разрешили вам использовать fcntl, потому что mac os X не поддерживает запись так же, как другие ОС Unix.
  Вы должны использовать неблокирующий FD, чтобы результат был аналогичен другим ОС.
  
  Поскольку вы используете неблокирующий FD, вы можете использовать функции чтения / получения или записи / отправки без опроса (или аналогичного), и ваш сервер не будет блокировать. Но мы этого не хотим.
  Снова попытка чтения / получения или записи / отправки в любом FD без прохождения опроса (или его эквивалента) даст вам оценку, равную 0, и завершение оценки.

  Вы можете использовать только fcntl следующим образом: fcntl (fd, F_SETFL, O_NONBLOCK); 
  Любые другие флаги запрещены

  
• В этом конфигурационном файле мы должны иметь возможность:
Вы можете вдохновиться «серверной» частью Nginx
конфигурационный файл
◦ выберите порт и хост каждого «сервера»
◦ настроить server_names или нет
◦ Первый сервер для host: port будет по умолчанию для этого host: port (то есть он будет отвечать на все запросы, которые не принадлежат другому серверу)
◦ настроить страницы ошибок по умолчанию
◦ ограничить размер тела клиента
◦ настроить маршруты с одним или несколькими из следующих правил / конфигураций (маршруты не будут использовать регулярное выражение):
* Определить список допустимых HTTP-методов для маршрута
* Определить перенаправление HTTP.
* Определить каталог или файл, из которого следует искать файл (например, если url / kapouet имеет корень / tmp / www, url / kapouet / pouic / toto / pouet будет / tmp / www / pouic / toto / pouet)
* Включить или выключить список каталогов
* Файл по умолчанию для ответа, если запрос является каталогом
* Выполнять CGI на основе определенного расширения файла (например .php)
· Вам интересно, что такое CGI?
· Поскольку вы не будете вызывать CGI напрямую, используйте полный путь как PATH_INFO
· Просто помнит, что для запроса с фрагментами ваш сервер должен его отключить, и CGI будет ожидать EOF как конец тела.
· То же самое для вывода CGI. если из CGI не возвращается content_length, EOF будет означать конец возвращаемых данных.
· Ваша программа должна вызывать cgi с запрошенным файлом в качестве первого аргумента
· Cgi должен запускаться в правильном каталоге для доступа к файлу относительного пути
· Ваш сервер должен работать с одним CGI (php-cgi, python ...)
* Сделать маршрут способным принимать загруженные файлы и настроить, где они должны быть сохранены
Вы должны предоставить некоторые файлы конфигурации и базовые файлы по умолчанию для тестирования / демонстрации работы каждой функции во время оценки.
  
Summary:

https://adrienblanc.com/projects/42/webserv

http://dwise1.net/pgm/sockets/blocking.html

https://habr.com/ru/post/152345/

http://rsdn.org/forum/job/4795893.flat

https://code-live.ru/post/cpp-http-server-over-sockets/

https://code.google.com/archive/p/mongoose/


